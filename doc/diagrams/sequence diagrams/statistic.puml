@startuml Statistics
actor Пользователь as User
participant "Веб-браузер" as Browser
participant "Контроллер проекта" as PC
participant "Сервис проекта и пользователя" as UPS
participant "База данных" as DB
participant "Сервис создания графиков" as CS

User -> Browser: Открыть страницу статистики проекта
Browser -> PC: GET /Projects/ProjectStatistics/{projectID}
PC -> UPS: Получить текущего пользователя
UPS -> DB: Выполнить запрос для получения пользователя
DB --> UPS: Возвращаем текущего пользователя
UPS --> PC: Возвращаем текущего пользователя

PC -> UPS: Получить проект по ID
UPS -> DB: Выполнить запрос для получения проекта
DB --> UPS: Возвращаем проект
UPS --> PC: Возвращаем проект

alt Проект и пользователь найдены
    PC -> DB: Получить задачи проекта
    DB --> PC: Возвращаем задачи проекта

    PC -> DB: Получить все статусы проекта
    DB --> PC: Возвращаем все статусы проекта

    PC -> DB: Получить все приоритеты проекта
    DB --> PC: Возвращаем все приоритеты проекта

    PC -> DB: Получить всех пользователей проекта
    DB --> PC: Возвращаем всех пользователей проекта

    PC -> CS: Получить данные для графиков
    CS --> PC: Возвращаем данные для графиков

    PC -> Browser: Вернуть страницу статистики проекта с данными и графиками

    User -> Browser: Настроить фильтры (даты, категории)
    Browser -> PC: POST /Projects/ProjectStatistics/{projectID} с startDate, endDate, selectedCategories

    PC -> UPS: Получить текущего пользователя
    UPS -> DB: Выполнить запрос для получения пользователя
    DB --> UPS: Возвращаем текущего пользователя
    UPS --> PC: Возвращаем текущего пользователя

    PC -> UPS: Получить проект по ID
    UPS -> DB: Выполнить запрос для получения проекта
    DB --> UPS: Возвращаем проект
    UPS --> PC: Возвращаем проект

    alt Проект и пользователь найдены
        PC -> DB: Получить задачи проекта с фильтрами
        DB --> PC: Возвращаем задачи проекта с фильтрами

        PC -> CS: Получить данные для графиков с фильтрами
        CS --> PC: Возвращаем данные для графиков с фильтрами

        PC -> Browser: Вернуть страницу статистики проекта с обновленными данными и графиками
    else Проект или пользователь не найдены
        PC -> Browser: Перенаправить на страницу ошибки
    end
else Проект или пользователь не найдены
    PC -> Browser: Перенаправить на страницу ошибки
end
@enduml